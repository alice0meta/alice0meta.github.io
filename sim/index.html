<!DOCTYPE html><html><head><meta charset="utf-8">
	<title>alice > sim</title>
	<style>
		body {background-color:#222;}
		td {width:16px; height:16px; text-align:center; cursor:pointer;}
		td {background-color:#ccc;}
		.on {background-color:#333;}
	</style>
	<script src="https://code.jquery.com/jquery-latest.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
</head><body>
</body></html>
<script>

Array.prototype.sum = function(){return this.reduce(function(a,b){return a+b},0)}
var print = console.log.bind(console)

// genetic cellular automata
// platformer where the enemies and environment are created by a (probably pretty slow) conway's game of life
// inspired by diamond hollow

var X = 60
var Y = 30

var empty_board = function(){return _.range(Y).map(function(v){return _.range(X).map(function(){return false})})}
var rand_board = function(){return _.range(Y).map(function(v){return _.range(X).map(function(){return Math.random()<0.5})})}

var board = rand_board()
var loop_token

$('body').html([
	$('<table>').html(_.range(Y).map(function(v){return $('<tr>').html(_.range(X).map(function(v,i){return $('<td>')}))})),
	$('<button id="pause">go</button>'),
	$('<input id="interval" value="0.2"></input>'),
	$('<button id="clear">clear</button>'),
	$('<button id="randomize">randomize</button>'),
	])

$('table').on('click','td',function(){var x = $(this).index(); var y = $(this).parent().index(); board[y][x] = !board[y][x]; regen(x,y)})
$('#pause').on('click',function(){
	$(this).text(loop_token? 'go' : 'pause')
	if (loop_token) {clearInterval(loop_token); loop_token = null} else loop_token = setInterval(loop,parseFloat($('#interval').val())*1000)})
$('#interval').on('change',function(){if (loop_token) {clearInterval(loop_token); loop_token = setInterval(loop,parseFloat($('#interval').val())*1000)}})
$('#clear').on('click',function(){board = empty_board(); regen_all()})
$('#randomize').on('click',function(){board = rand_board(); regen_all()})

var regen = function(x,y){$('tr').eq(y).find('td').eq(x).toggleClass('on',!!board[y][x])}
var regen_all = function(){_.range(Y).map(function(y){_.range(X).map(function(x){regen(x,y)})})}

var tick = function(board){
	var t = function(x,y){return (board[y]||[])[x]}
	return board.map(function(v,y){return v.map(function(v,x){
		var n = _.range(-1,2).map(function(yi){return _.range(-1,2).map(function(xi){return (t(x+xi,y+yi)?1:0)}).sum()}).sum()
		return n===3 || (v && n===4)})})}

var loop = function(){board = tick(board); regen_all()}

regen_all()
</script>
